import type { AppLanguage } from '@/hooks/useLanguage';

type UiReplacement = {
  pattern: RegExp;
  value: string | ((...args: any[]) => string);
};

const FRENCH_REPLACEMENTS: UiReplacement[] = [
  { pattern: /National Bank Capital Markets/g, value: 'Banque Nationale Marches des capitaux' },
  { pattern: /Your trading behavior at a glance/g, value: 'Votre comportement de trading en un coup d\'oeil' },
  { pattern: /Your behavioral trading coach with personalized guidance/g, value: 'Votre coach comportemental avec des conseils personnalises' },
  { pattern: /Upload a CSV or manually add trades to start your analysis/g, value: 'Importez un CSV ou ajoutez des transactions manuellement pour commencer votre analyse' },
  { pattern: /Upload a CSV or use saved trades to detect behavioral biases/g, value: 'Importez un CSV ou utilisez des transactions enregistrees pour detecter les biais comportementaux' },
  { pattern: /Optimization insights and allocation overview/g, value: 'Apercu de l\'allocation et recommandations d\'optimisation' },
  { pattern: /Manage your full trade history/g, value: 'Gerez l\'historique complet de vos transactions' },
  { pattern: /Import your trading history via CSV or add trades manually/g, value: 'Importez votre historique via CSV ou ajoutez des transactions manuellement' },
  { pattern: /Manage your profile and security/g, value: 'Gerez votre profil et votre securite' },
  { pattern: /Protect your account by requiring a code from your authenticator app when signing in\./g, value: 'Protegez votre compte en exigeant un code de votre application d\'authentification a la connexion.' },
  { pattern: /Server-side pagination and search for fast loading/g, value: 'Pagination et recherche cote serveur pour un chargement rapide' },
  { pattern: /Open chat with Laurent Ferreira/g, value: 'Ouvrir le chat avec Laurent Ferreira' },
  { pattern: /Clear all chat history with Laurent Ferreira\?/g, value: 'Effacer tout l\'historique de chat avec Laurent Ferreira ?' },
  { pattern: /Clear all saved trades\? This action cannot be undone\./g, value: 'Effacer toutes les transactions enregistrees ? Cette action est irreversible.' },
  { pattern: /Clear all emotional tracker entries\? This cannot be undone\./g, value: 'Effacer toutes les entrees du suivi emotionnel ? Cette action est irreversible.' },
  { pattern: /Switch to French/g, value: 'Passer en francais' },
  { pattern: /Switch to English/g, value: 'Passer en anglais' },
  { pattern: /Signed in as/g, value: 'Connecte en tant que' },
  { pattern: /Start a conversation with Laurent Ferreira/g, value: 'Demarrer une conversation avec Laurent Ferreira' },
  { pattern: /Ask about your trading biases, get personalized tips, or discuss your trading psychology\./g, value: 'Posez des questions sur vos biais de trading, obtenez des conseils personnalises et discutez de votre psychologie de trading.' },
  { pattern: /What are my biggest trading weaknesses\?/g, value: 'Quelles sont mes plus grandes faiblesses de trading ?' },
  { pattern: /How can I avoid revenge trading\?/g, value: 'Comment eviter le revenge trading ?' },
  { pattern: /Analyze my risk management/g, value: 'Analyse ma gestion du risque' },
  { pattern: /Give me tips to improve discipline/g, value: 'Donne-moi des conseils pour ameliorer ma discipline' },
  { pattern: /Ask Laurent/g, value: 'Demander a Laurent' },
  { pattern: /Bias Detector/g, value: 'Detecteur de biais' },
  { pattern: /Dashboard/g, value: 'Tableau de bord' },
  { pattern: /Trading/g, value: 'Trading' },
  { pattern: /Analytics/g, value: 'Analytique' },
  { pattern: /Workspace/g, value: 'Espace de travail' },
  { pattern: /Upload Trades/g, value: 'Importer des transactions' },
  { pattern: /All Trades/g, value: 'Toutes les transactions' },
  { pattern: /Portfolio/g, value: 'Portefeuille' },
  { pattern: /Bias Analysis/g, value: 'Analyse des biais' },
  { pattern: /Risk Profile/g, value: 'Profil de risque' },
  { pattern: /Emotional Tracker/g, value: 'Suivi emotionnel' },
  { pattern: /Settings/g, value: 'Parametres' },
  { pattern: /Sign Out/g, value: 'Se deconnecter' },
  { pattern: /Refresh Profile/g, value: 'Actualiser le profil' },
  { pattern: /Generate Profile/g, value: 'Generer le profil' },
  { pattern: /Refresh/g, value: 'Actualiser' },
  { pattern: /Clear Trades/g, value: 'Effacer les transactions' },
  { pattern: /Clear Entries/g, value: 'Effacer les entrees' },
  { pattern: /Clear Chat History/g, value: 'Effacer l\'historique du chat' },
  { pattern: /No trades yet/g, value: 'Aucune transaction pour le moment' },
  { pattern: /No trades found\./g, value: 'Aucune transaction trouvee.' },
  { pattern: /No rows on this page\./g, value: 'Aucune ligne sur cette page.' },
  { pattern: /No trading data/g, value: 'Aucune donnee de trading' },
  { pattern: /No P\/L data available/g, value: 'Aucune donnee P/L disponible' },
  { pattern: /No risk profile yet/g, value: 'Aucun profil de risque pour le moment' },
  { pattern: /No data yet/g, value: 'Aucune donnee pour le moment' },
  { pattern: /View All/g, value: 'Voir tout' },
  { pattern: /Previous/g, value: 'Precedent' },
  { pattern: /Next/g, value: 'Suivant' },
  { pattern: /Go to Analysis/g, value: 'Aller a l\'analyse' },
  { pattern: /\bGo\b/g, value: 'Aller' },
  { pattern: /Jump to/g, value: 'Aller a la page' },
  { pattern: /Showing/g, value: 'Affichage' },
  { pattern: /Matching Trades/g, value: 'Transactions correspondantes' },
  { pattern: /Total Trades/g, value: 'Transactions totales' },
  { pattern: /Total P\/L/g, value: 'P/L total' },
  { pattern: /Visible P\/L/g, value: 'P/L visible' },
  { pattern: /Win Rate/g, value: 'Taux de reussite' },
  { pattern: /Biases Found/g, value: 'Biais detectes' },
  { pattern: /P\/L Index by Stock/g, value: 'Indice P/L par action' },
  { pattern: /Select stock/g, value: 'Selectionner une action' },
  { pattern: /lifespan, normalized to index 100 at first trade/g, value: 'periode, normalisee a l\'indice 100 au premier trade' },
  { pattern: /No P\/L timeline available for this stock/g, value: 'Aucune chronologie P/L disponible pour cette action' },
  { pattern: /Bias Radar \(6-Factor\)/g, value: 'Radar des biais (6 facteurs)' },
  { pattern: /Run analysis to see bias distribution/g, value: 'Lancez une analyse pour voir la repartition des biais' },
  { pattern: /Recent Trades/g, value: 'Transactions recentes' },
  { pattern: /Risk Profile Score/g, value: 'Score du profil de risque' },
  { pattern: /Discipline/g, value: 'Discipline' },
  { pattern: /Emotional Control/g, value: 'Controle emotionnel' },
  { pattern: /Overtrading Risk/g, value: 'Risque de surtrading' },
  { pattern: /Loss Aversion/g, value: 'Aversion aux pertes' },
  { pattern: /\bOvertrading\b/g, value: 'Surtrading' },
  { pattern: /Revenge Trading/g, value: 'Trading de revanche' },
  { pattern: /Disposition Effect/g, value: 'Effet de disposition' },
  { pattern: /Anchoring/g, value: 'Ancrage' },
  { pattern: /Confirmation Bias/g, value: 'Biais de confirmation' },
  { pattern: /\bIndex\b/g, value: 'Indice' },
  { pattern: /Trade P\/L/g, value: 'P\/L de transaction' },
  { pattern: /Signals/g, value: 'Signaux' },
  { pattern: /Occurrences/g, value: 'Occurrences' },
  { pattern: /Score/g, value: 'Score' },
  { pattern: /Date/g, value: 'Date' },
  { pattern: /Asset/g, value: 'Actif' },
  { pattern: /Action/g, value: 'Action' },
  { pattern: /Qty/g, value: 'Qte' },
  { pattern: /Entry/g, value: 'Entree' },
  { pattern: /Exit/g, value: 'Sortie' },
  { pattern: /Remove/g, value: 'Supprimer' },
  { pattern: /Trade Records/g, value: 'Historique des transactions' },
  { pattern: /Filter by asset, action, or note\.\.\./g, value: 'Filtrer par actif, action ou note...' },
  { pattern: /Page (\d+) of (\d+)/g, value: (_m, p1, p2) => `Page ${p1} sur ${p2}` },
  { pattern: /Showing (\d+)-(\d+) of ([\d,]+)/g, value: (_m, p1, p2, p3) => `Affichage ${p1}-${p2} sur ${p3}` },
  { pattern: /Upload a CSV file with columns:/g, value: 'Importez un fichier CSV avec les colonnes :' },
  { pattern: /Drop your CSV file here/g, value: 'Deposez votre fichier CSV ici' },
  { pattern: /or click to browse/g, value: 'ou cliquez pour parcourir' },
  { pattern: /Trades Parsed/g, value: 'Transactions analysees' },
  { pattern: /Review before saving/g, value: 'Verifiez avant de sauvegarder' },
  { pattern: /Clear/g, value: 'Effacer' },
  { pattern: /Save All/g, value: 'Tout sauvegarder' },
  { pattern: /Saving ([\d,]+) \/ ([\d,]+)/g, value: (_m, p1, p2) => `Sauvegarde ${p1} / ${p2}` },
  { pattern: /Showing first 50 of (\d+) trades/g, value: (_m, p1) => `Affichage des 50 premieres sur ${p1} transactions` },
  { pattern: /Manual Entry/g, value: 'Saisie manuelle' },
  { pattern: /Add individual trades/g, value: 'Ajouter des transactions individuelles' },
  { pattern: /Show Form/g, value: 'Afficher le formulaire' },
  { pattern: /Hide Form/g, value: 'Masquer le formulaire' },
  { pattern: /Timestamp/g, value: 'Horodatage' },
  { pattern: /Buy/g, value: 'Acheter' },
  { pattern: /Sell/g, value: 'Vendre' },
  { pattern: /Quantity/g, value: 'Quantite' },
  { pattern: /Entry Price/g, value: 'Prix d\'entree' },
  { pattern: /Exit Price/g, value: 'Prix de sortie' },
  { pattern: /Account Balance/g, value: 'Solde du compte' },
  { pattern: /Notes/g, value: 'Notes' },
  { pattern: /Optional notes/g, value: 'Notes facultatives' },
  { pattern: /Add Trade/g, value: 'Ajouter la transaction' },
  { pattern: /Trading intensity by hour/g, value: 'Intensite de trading par heure' },
  { pattern: /Number of trades per hour of day \(UTC or local\)/g, value: 'Nombre de transactions par heure de la journee (UTC ou locale)' },
  { pattern: /Trade Journal/g, value: 'Journal de transactions' },
  { pattern: /Biased trades are highlighted in red\./g, value: 'Les transactions biaisees sont mises en rouge.' },
  { pattern: /Buy\/Sell/g, value: 'Achat/Vente' },
  { pattern: /Balance/g, value: 'Solde' },
  { pattern: /Bias Score/g, value: 'Score de biais' },
  { pattern: /Overall behavioral bias intensity \(0 = none, 100 = severe\)/g, value: 'Intensite globale des biais comportementaux (0 = aucun, 100 = severe)' },
  { pattern: /Bias Radar/g, value: 'Radar des biais' },
  { pattern: /Overtrading, loss aversion, revenge \(0-100\)/g, value: 'Surtrading, aversion aux pertes, revenge (0-100)' },
  { pattern: /Run Analysis/g, value: 'Lancer l\'analyse' },
  { pattern: /Analyzing\.{3}|Analyzing…/g, value: 'Analyse en cours...' },
  { pattern: /How are you feeling\?/g, value: 'Comment vous sentez-vous ?' },
  { pattern: /Tag your current state before or after trading/g, value: 'Indiquez votre etat avant ou apres le trading' },
  { pattern: /Intensity:/g, value: 'Intensite :' },
  { pattern: /Log State/g, value: 'Enregistrer l\'etat' },
  { pattern: /Emotional Patterns/g, value: 'Tendances emotionnelles' },
  { pattern: /Recent Entries/g, value: 'Entrees recentes' },
  { pattern: /Portfolio Analysis/g, value: 'Analyse de portefeuille' },
  { pattern: /Total Volume/g, value: 'Volume total' },
  { pattern: /Assets Traded/g, value: 'Actifs trades' },
  { pattern: /Top Concentration/g, value: 'Concentration principale' },
  { pattern: /Asset Allocation/g, value: 'Allocation des actifs' },
  { pattern: /Cumulative P\/L/g, value: 'P/L cumulatif' },
  { pattern: /Optimization Recommendations/g, value: 'Recommandations d\'optimisation' },
  { pattern: /Based on your portfolio composition/g, value: 'Base sur la composition de votre portefeuille' },
  { pattern: /Coach Insights/g, value: 'Apercus du coach' },
  { pattern: /No insights yet\. Add trades to unlock summaries and chart insights\./g, value: 'Aucun apercu pour le moment. Ajoutez des transactions pour debloquer des resumes et graphiques.' },
  { pattern: /Trades\/Day/g, value: 'Transactions/jour' },
  { pattern: /Bias Summary/g, value: 'Resume des biais' },
  { pattern: /P\/L Timeline/g, value: 'Chronologie P/L' },
  { pattern: /No timeline data yet/g, value: 'Aucune chronologie disponible pour le moment' },
  { pattern: /Asset Activity/g, value: 'Activite par actif' },
  { pattern: /No asset activity yet/g, value: 'Aucune activite d\'actif pour le moment' },
  { pattern: /Trading Heatmap \(Day x Hour\)/g, value: 'Carte thermique de trading (jour x heure)' },
  { pattern: /Personalized Suggestions/g, value: 'Suggestions personnalisees' },
  { pattern: /Journaling Prompts/g, value: 'Suggestions de journal' },
  { pattern: /Start chatting with Laurent Ferreira/g, value: 'Commencez a discuter avec Laurent Ferreira' },
  { pattern: /Insights/g, value: 'Apercus' },
  { pattern: /Message Laurent Ferreira\.\.\./g, value: 'Message a Laurent Ferreira...' },
  { pattern: /Ask Laurent Ferreira\.\.\./g, value: 'Demandez a Laurent Ferreira...' },
  { pattern: /Behavior Analytics/g, value: 'Analyse comportementale' },
  { pattern: /Risk Oversight/g, value: 'Surveillance du risque' },
  { pattern: /Already have an account\?/g, value: 'Vous avez deja un compte ?' },
  { pattern: /Need an account\?/g, value: 'Besoin d\'un compte ?' },
  { pattern: /National Bank Platform/g, value: 'Plateforme Banque Nationale' },
  { pattern: /Trade with discipline and measurable confidence\./g, value: 'Tradez avec discipline et confiance mesurable.' },
  { pattern: /Operational focus/g, value: 'Priorite operationnelle' },
  { pattern: /Create your account/g, value: 'Creez votre compte' },
  { pattern: /Sign in/g, value: 'Connexion' },
  { pattern: /Start your behavior-driven trading review\./g, value: 'Demarrez votre analyse de trading basee sur les comportements.' },
  { pattern: /Access your trading bias dashboard\./g, value: 'Accedez a votre tableau de bord des biais de trading.' },
  { pattern: /Display Name/g, value: 'Nom affiche' },
  { pattern: /Your name/g, value: 'Votre nom' },
  { pattern: /Email/g, value: 'Courriel' },
  { pattern: /Password/g, value: 'Mot de passe' },
  { pattern: /Enter password/g, value: 'Entrez le mot de passe' },
  { pattern: /Create Account/g, value: 'Creer un compte' },
  { pattern: /Sign In/g, value: 'Se connecter' },
  { pattern: /Don't have an account\? Create one/g, value: 'Vous n\'avez pas de compte ? Creez-en un' },
  { pattern: /Already have an account\? Sign in/g, value: 'Vous avez deja un compte ? Connectez-vous' },
  { pattern: /Two-Factor Authentication/g, value: 'Authentification a deux facteurs' },
  { pattern: /Add an extra layer of security to your account/g, value: 'Ajoutez une couche de securite supplementaire a votre compte' },
  { pattern: /2FA is enabled/g, value: '2FA est active' },
  { pattern: /Scan this QR code with your authenticator app/g, value: 'Scannez ce code QR avec votre application d\'authentification' },
  { pattern: /Or enter manually:/g, value: 'Ou saisir manuellement :' },
  { pattern: /Enter the 6-digit code from your app/g, value: 'Entrez le code a 6 chiffres de votre application' },
  { pattern: /Cancel/g, value: 'Annuler' },
  { pattern: /Verify & Enable/g, value: 'Verifier et activer' },
  { pattern: /Set Up 2FA/g, value: 'Configurer la 2FA' },
  { pattern: /Save Changes/g, value: 'Enregistrer les modifications' },
  { pattern: /Return to Home/g, value: 'Retour a l\'accueil' },
  { pattern: /Oops! Page not found/g, value: 'Oups ! Page introuvable' },
  { pattern: /Page not found/g, value: 'Page introuvable' },
  { pattern: /Set language to French/g, value: 'Passer en francais' },
  { pattern: /Set language to English/g, value: 'Passer en anglais' },
];

const FRENCH_CACHE = new Map<string, string>();
const MAX_CACHE_ENTRIES = 2000;

function applyFrenchReplacements(text: string): string {
  const cached = FRENCH_CACHE.get(text);
  if (cached !== undefined) {
    return cached;
  }

  let output = text;

  for (const entry of FRENCH_REPLACEMENTS) {
    output = output.replace(entry.pattern, entry.value as any);
  }

  if (FRENCH_CACHE.size >= MAX_CACHE_ENTRIES) {
    FRENCH_CACHE.clear();
  }
  FRENCH_CACHE.set(text, output);

  return output;
}

export function translateUiText(text: string, language: AppLanguage): string {
  if (language === 'en' || text.length === 0) {
    return text;
  }

  return applyFrenchReplacements(text);
}
